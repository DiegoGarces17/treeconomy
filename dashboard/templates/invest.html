{% extends 'base.html' %}
{% load static %}
{% block title %} Cartera {% endblock title %}



{% block content %}
<link rel="stylesheet"  href="{% static "dashboard/css/argon.css" %}" type="text/css">
{% include "includes/scripts.html" %}


<div class="container-fluid">

      <div class="card">
        <div class="card-header border-0">
          <div class="row align-items-center">
            <div class="col-sm col-md-8">
              <h2 class="mb-0">Tu inversión</h2>
              <p>Los datos están presentados desde la fecha de plantación del proyecto, mensualmente, hasta el mes actual.</p>
            </div>
            <div class="col-sm col-md-4">
                
                <div role="tablist">
                    <h5>Proyectos en los que haz invertido:</h5>
                    <ul class="nav" role="tablist" id="botones-proyectos">
                    </ul>
                </div>
                            
            </div>
          </div>
        </div>

        <div class="tab-content table-responsive" id="nav-tabContent">
            
        </div>
      </div>
</div>

{% endblock %}

{% block javascripts %}
<script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
<script>
    consultar_todos()
    function consultar_todos(){
        $.ajax({
            type: 'GET',
            url: "{% url 'invest_api' %}",
            //data: {"nick_name": nick_name},
            success: function (response) {
                // if not valid user, alert the user
                console.log(response)
                proyects = Object.keys(response)
                datos = response
                proyects.forEach(function(element){
                    elem_low= element.toLowerCase()
                    inv = datos[element]
                    
                    datostable = ''
                    for(let k in inv){
                        datostable += '<tr><td>'+ k +'</td>'+
                        '<td>'+ inv[k]["new_trees"] +'</td>'+
                        '<td>'+ inv[k]["total_trees"] +'</td>' +
                        '<td>'+ '$' + inv[k]["valor_invertido"] +'</td>'+
                        '<td>'+ inv[k]["rentabilidad"] + '%' +'</td>'+
                        '<td>'+ '$' + inv[k]["utilidad"] +'</td>'+
                        '<td>'+ '$' + inv[k]["capital"] +'</td>'+
                        '</tr>'
                    }
                    document.getElementById('botones-proyectos').innerHTML += "<li class='nav-item mr-1'><a class='button-plant' href='#"+elem_low+"' data-toggle='tab' role='tab' aria-controls='nav-"+elem_low+"' aria-selected='true'>"+element+"</a></li>";
                    tabla = '<div class="tab-pane fade" id="'+elem_low+'" role="tabpanel" aria-labelledby="'+elem_low+'-tab">'+
                        '<table class="table align-items-center table-flush" id="tabla-inversion">' +
                            '<thead class="thead-light">'+
                              '<tr>'+
                                '<th scope="col">Fecha</th>'+
                                '<th scope="col">Árboles nuevos</th>'+
                                '<th scope="col">Árboles totales</th>'+
                                '<th scope="col">Inversión</th>'+
                                '<th scope="col">Rentabilidad</th>'+
                                '<th scope="col">Utilidad</th>'+
                                '<th scope="col">Capital</th>'+
                              '</tr>'+
                            '</thead>'+
                            '<tbody>'+
                                    datostable 
                            '</tbody>'+
                          '</table>'+
                    '</div>'
                    document.getElementById('nav-tabContent').innerHTML += tabla
                })
                if(!response){
                    alert("You cannot create a friend with same nick name");
                    var nickName = $("#id_nick_name");
                    nickName.val("")
                    nickName.focus()
                }
            },
            error: function (response) {
                console.log(response)
            }
        })
    }

</script>
{% endblock javascripts %}